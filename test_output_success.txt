[dotenv@17.2.3] injecting env (9) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops


  SSVPL MLM System - Master Verification Suite (100% Coverage)
    1. Authentication & Registration
      âœ” TEST 1: Basic Registration Flow (758ms)
      âœ” TEST 2: PAN Card Limit Enforcement (1067ms)
      âœ” TEST 3: Extreme Left Spillover (1079ms)
    2. KYC Workflow
      âœ” TEST 1: State Machine (Pending -> Verified -> Resubmit Block) (360ms)
      âœ” TEST 2: Rejection Allows Resubmission (359ms)
    3. BV Propagation Engine
      1) TEST 1: Deep Propagation
      2) TEST 2: Inactive User Skip
    4. Fast Track Bonus
      âœ” TEST 1: 4-Hour Gap Enforcement
Daily Limit Reached for FT_TEST
      âœ” TEST 2: Daily Limit (6 Max)
      âœ” TEST 3: Carry Forward Persistence
      3) TEST 4: Deductions (Net Calculation)
      âœ” TEST 5: Rank Deduction (3rd Match)
    5. Star Matching Bonus
      âœ” TEST 1: Star Match (10:20 Ratio) (373ms)
    6. Rank Upgrade
      4) TEST 1: Rank Bonus Creation
    7. Cron Jobs
Daily counters reset successfully.
      âœ” TEST 1: Daily Reset (390ms)
Processing Weekly Payout for 1 users...
Weekly Payout Completed.
      5) TEST 2: Weekly Payout
    8. Financial System
      6) TEST 1: Withdrawal Request Locking
    9. Concurrency & Stress
      7) TEST 1: 10 Concurrent BV Propagations


  11 passing (12s)
  7 failing

  1) SSVPL MLM System - Master Verification Suite (100% Coverage)
       3. BV Propagation Engine
         TEST 1: Deep Propagation:
     ValidationError: BVTransaction validation failed: transactionType: `purchase` is not a valid enum value for path `transactionType`.
      at Document.invalidate (node_modules/mongoose/lib/document.js:3385:32)
      at validatePath (node_modules/mongoose/lib/document.js:3160:13)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Promise.all (index 1)
      at async model.$__validate (node_modules/mongoose/lib/document.js:3101:3)
      at async model.validate (node_modules/mongoose/lib/document.js:2672:5)
      at async model.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:34:7)
      at async Kareem.execPre (node_modules/kareem/index.js:65:24)
      at async model.$__save (node_modules/mongoose/lib/model.js:369:5)
      at async model.save (node_modules/mongoose/lib/model.js:609:5)
      at async /home/zephyrus/UlMind_Projects/sarvasolution_backend/node_modules/mongoose/lib/model.js:2714:9
      at async Promise.all (index 0)
      at async Function.create (node_modules/mongoose/lib/model.js:2699:11)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:142:17)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:215:13)

  2) SSVPL MLM System - Master Verification Suite (100% Coverage)
       3. BV Propagation Engine
         TEST 2: Inactive User Skip:
     ValidationError: BVTransaction validation failed: transactionType: `purchase` is not a valid enum value for path `transactionType`.
      at Document.invalidate (node_modules/mongoose/lib/document.js:3385:32)
      at validatePath (node_modules/mongoose/lib/document.js:3160:13)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Promise.all (index 1)
      at async model.$__validate (node_modules/mongoose/lib/document.js:3101:3)
      at async model.validate (node_modules/mongoose/lib/document.js:2672:5)
      at async model.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:34:7)
      at async Kareem.execPre (node_modules/kareem/index.js:65:24)
      at async model.$__save (node_modules/mongoose/lib/model.js:369:5)
      at async model.save (node_modules/mongoose/lib/model.js:609:5)
      at async /home/zephyrus/UlMind_Projects/sarvasolution_backend/node_modules/mongoose/lib/model.js:2714:9
      at async Promise.all (index 0)
      at async Function.create (node_modules/mongoose/lib/model.js:2699:11)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:142:17)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:229:13)

  3) SSVPL MLM System - Master Verification Suite (100% Coverage)
       4. Fast Track Bonus
         TEST 4: Deductions (Net Calculation):
     TypeError: Cannot read properties of null (reading 'netAmount')
      at Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:303:27)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

  4) SSVPL MLM System - Master Verification Suite (100% Coverage)
       6. Rank Upgrade
         TEST 1: Rank Bonus Creation:

      AssertionError: expected 'completed' to equal 'pending'
      + expected - actual

      -completed
      +pending
      
      at Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:344:38)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

  5) SSVPL MLM System - Master Verification Suite (100% Coverage)
       7. Cron Jobs
         TEST 2: Weekly Payout:

      AssertionError: expected 5000 to equal 8000
      + expected - actual

      -5000
      +8000
      
      at Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:364:54)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

  6) SSVPL MLM System - Master Verification Suite (100% Coverage)
       8. Financial System
         TEST 1: Withdrawal Request Locking:
     Error: Insufficient balance in wallet
      at Object.validateWithdrawal (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/payout.service.js:21:19)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Object.requestWithdrawal (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/payout.service.js:31:22)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:379:13)

  7) SSVPL MLM System - Master Verification Suite (100% Coverage)
       9. Concurrency & Stress
         TEST 1: 10 Concurrent BV Propagations:
     ValidationError: BVTransaction validation failed: transactionType: `purchase` is not a valid enum value for path `transactionType`.
      at Document.invalidate (node_modules/mongoose/lib/document.js:3385:32)
      at validatePath (node_modules/mongoose/lib/document.js:3160:13)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Promise.all (index 1)
      at async model.$__validate (node_modules/mongoose/lib/document.js:3101:3)
      at async model.validate (node_modules/mongoose/lib/document.js:2672:5)
      at async model.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:34:7)
      at async Kareem.execPre (node_modules/kareem/index.js:65:24)
      at async model.$__save (node_modules/mongoose/lib/model.js:369:5)
      at async model.save (node_modules/mongoose/lib/model.js:609:5)
      at async /home/zephyrus/UlMind_Projects/sarvasolution_backend/node_modules/mongoose/lib/model.js:2714:9
      at async Promise.all (index 0)
      at async Function.create (node_modules/mongoose/lib/model.js:2699:11)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:142:17)
      at async Promise.all (index 7)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:395:13)



