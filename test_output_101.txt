[dotenv@17.2.3] injecting env (9) from .env -- tip: ⚙️  suppress all logs with { quiet: true }


  SSVPL MLM System - Master Verification Suite (100% Coverage)
    1. Authentication & Registration
      ✔ TEST 1: Basic Registration Flow (747ms)
      ✔ TEST 2: PAN Card Limit Enforcement (1059ms)
      ✔ TEST 3: Extreme Left Spillover (1083ms)
    2. KYC Workflow
      1) TEST 1: State Machine (Pending -> Verified -> Resubmit Block)
      ✔ TEST 2: Rejection Allows Resubmission (351ms)
    3. BV Propagation Engine
      2) TEST 1: Deep Propagation
      3) TEST 2: Inactive User Skip
    4. Fast Track Bonus
      ✔ TEST 1: 4-Hour Gap Enforcement
Daily Limit Reached for FT_TEST
      ✔ TEST 2: Daily Limit (6 Max)
      ✔ TEST 3: Carry Forward Persistence
      4) TEST 4: Deductions (Net Calculation)
      ✔ TEST 5: Rank Deduction (3rd Match)
    5. Star Matching Bonus
      5) TEST 1: Star Match (10:20 Ratio)
    7. Cron Jobs
Daily counters reset successfully.
      ✔ TEST 1: Daily Reset (353ms)
Processing Weekly Payout for 1 users...
Weekly Payout Completed.
      ✔ TEST 2: Weekly Payout (380ms)
    8. Financial System
      6) TEST 1: Withdrawal Request Locking
    9. Concurrency & Stress
      7) TEST 1: 10 Concurrent BV Propagations


  10 passing (10s)
  7 failing

  1) SSVPL MLM System - Master Verification Suite (100% Coverage)
       2. KYC Workflow
         TEST 1: State Machine (Pending -> Verified -> Resubmit Block):
     TypeError: Cannot read properties of undefined (reading 'push')
      at Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:192:42)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) SSVPL MLM System - Master Verification Suite (100% Coverage)
       3. BV Propagation Engine
         TEST 1: Deep Propagation:
     CastError: Cast to ObjectId failed for value "SVS000002" (type string) at path "_id" for model "User"
      at SchemaObjectId.cast (node_modules/mongoose/lib/schema/objectId.js:253:11)
      at SchemaType.applySetters (node_modules/mongoose/lib/schemaType.js:1280:12)
      at SchemaType.castForQuery (node_modules/mongoose/lib/schemaType.js:1706:17)
      at cast (node_modules/mongoose/lib/cast.js:386:32)
      at Query.cast (node_modules/mongoose/lib/query.js:5040:12)
      at Query._castConditions (node_modules/mongoose/lib/query.js:2374:10)
      at model.Query._findOne (node_modules/mongoose/lib/query.js:2704:8)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4652:80)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:121:28)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:226:13)

  3) SSVPL MLM System - Master Verification Suite (100% Coverage)
       3. BV Propagation Engine
         TEST 2: Inactive User Skip:
     CastError: Cast to ObjectId failed for value "SVS000002" (type string) at path "_id" for model "User"
      at SchemaObjectId.cast (node_modules/mongoose/lib/schema/objectId.js:253:11)
      at SchemaType.applySetters (node_modules/mongoose/lib/schemaType.js:1280:12)
      at SchemaType.castForQuery (node_modules/mongoose/lib/schemaType.js:1706:17)
      at cast (node_modules/mongoose/lib/cast.js:386:32)
      at Query.cast (node_modules/mongoose/lib/query.js:5040:12)
      at Query._castConditions (node_modules/mongoose/lib/query.js:2374:10)
      at model.Query._findOne (node_modules/mongoose/lib/query.js:2704:8)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4652:80)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:121:28)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:240:13)

  4) SSVPL MLM System - Master Verification Suite (100% Coverage)
       4. Fast Track Bonus
         TEST 4: Deductions (Net Calculation):
     TypeError: Cannot read properties of null (reading 'netAmount')
      at Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:329:27)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)

  5) SSVPL MLM System - Master Verification Suite (100% Coverage)
       5. Star Matching Bonus
         TEST 1: Star Match (10:20 Ratio):
     ValidationError: Payout validation failed: payoutType: `rank-bonus` is not a valid enum value for path `payoutType`.
      at Document.invalidate (node_modules/mongoose/lib/document.js:3385:32)
      at validatePath (node_modules/mongoose/lib/document.js:3160:13)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Promise.all (index 2)
      at async model.$__validate (node_modules/mongoose/lib/document.js:3101:3)
      at async model.validate (node_modules/mongoose/lib/document.js:2672:5)
      at async model.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:34:7)
      at async Kareem.execPre (node_modules/kareem/index.js:65:24)
      at async model.$__save (node_modules/mongoose/lib/model.js:369:5)
      at async model.save (node_modules/mongoose/lib/model.js:609:5)
      at async /home/zephyrus/UlMind_Projects/sarvasolution_backend/node_modules/mongoose/lib/model.js:2714:9
      at async Promise.all (index 0)
      at async Function.create (node_modules/mongoose/lib/model.js:2699:11)
      at async Object.checkRankUpgrade (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/rank.service.js:65:17)
      at async Object.processStarMatching (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/matching.service.js:252:9)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:352:13)

  6) SSVPL MLM System - Master Verification Suite (100% Coverage)
       8. Financial System
         TEST 1: Withdrawal Request Locking:
     Error: Insufficient balance in wallet
      at Object.validateWithdrawal (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/payout.service.js:21:19)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Object.requestWithdrawal (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/payout.service.js:31:22)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:395:13)

  7) SSVPL MLM System - Master Verification Suite (100% Coverage)
       9. Concurrency & Stress
         TEST 1: 10 Concurrent BV Propagations:
     CastError: Cast to ObjectId failed for value "SVS000001" (type string) at path "_id" for model "User"
      at SchemaObjectId.cast (node_modules/mongoose/lib/schema/objectId.js:253:11)
      at SchemaType.applySetters (node_modules/mongoose/lib/schemaType.js:1280:12)
      at SchemaType.castForQuery (node_modules/mongoose/lib/schemaType.js:1706:17)
      at cast (node_modules/mongoose/lib/cast.js:386:32)
      at Query.cast (node_modules/mongoose/lib/query.js:5040:12)
      at Query._castConditions (node_modules/mongoose/lib/query.js:2374:10)
      at model.Query._findOne (node_modules/mongoose/lib/query.js:2704:8)
      at model.Query.exec (node_modules/mongoose/lib/query.js:4652:80)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
      at async Object.propagateBVUpTree (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/src/services/mlm.service.js:121:28)
      at async Promise.all (index 0)
      at async Context.<anonymous> (file:///home/zephyrus/UlMind_Projects/sarvasolution_backend/test/master_test.js:416:13)



